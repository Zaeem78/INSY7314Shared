{"ast":null,"code":"import _objectSpread from\"C:/Users/pc/Desktop/INSY7314/INSY7314/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useContext,useReducer,useEffect}from'react';import axios from'axios';// Set up axios defaults\nimport{jsx as _jsx}from\"react/jsx-runtime\";axios.defaults.baseURL=process.env.REACT_APP_API_URL||'http://localhost:3001/api';axios.defaults.withCredentials=true;const AuthContext=/*#__PURE__*/createContext();// Auth reducer\nconst authReducer=(state,action)=>{switch(action.type){case'LOGIN_START':return _objectSpread(_objectSpread({},state),{},{loading:true,error:null});case'LOGIN_SUCCESS':return _objectSpread(_objectSpread({},state),{},{isLoggedIn:true,user:action.payload.user,token:action.payload.token,loading:false,error:null});case'LOGIN_FAILURE':return _objectSpread(_objectSpread({},state),{},{isLoggedIn:false,user:null,token:null,loading:false,error:action.payload});case'LOGOUT':return{isLoggedIn:false,user:null,token:null,loading:false,error:null};case'CLEAR_ERROR':return _objectSpread(_objectSpread({},state),{},{error:null});default:return state;}};const initialState={isLoggedIn:false,user:null,token:null,loading:false,error:null};export const AuthProvider=_ref=>{let{children}=_ref;const[state,dispatch]=useReducer(authReducer,initialState);// Check for existing token on app start\nuseEffect(()=>{const token=localStorage.getItem('token');const user=localStorage.getItem('user');if(token&&user){try{const userData=JSON.parse(user);dispatch({type:'LOGIN_SUCCESS',payload:{token,user:userData}});// Set axios default header\naxios.defaults.headers.common['Authorization']=\"Bearer \".concat(token);}catch(error){// Invalid stored data, clear it\nlocalStorage.removeItem('token');localStorage.removeItem('user');}}},[]);const login=async(username,accountNumber,password)=>{dispatch({type:'LOGIN_START'});try{const response=await axios.post('/auth/login',{username,accountNumber,password});const{token,user}=response.data;// Store in localStorage\nlocalStorage.setItem('token',token);localStorage.setItem('user',JSON.stringify(user));// Set axios default header\naxios.defaults.headers.common['Authorization']=\"Bearer \".concat(token);dispatch({type:'LOGIN_SUCCESS',payload:{token,user}});return{success:true};}catch(error){let errorMessage='Login failed';if(error.response&&error.response.data&&error.response.data.error){errorMessage=error.response.data.error;}else if(error.message){errorMessage=error.message;}dispatch({type:'LOGIN_FAILURE',payload:errorMessage});return{success:false,error:errorMessage};}};const logout=()=>{localStorage.removeItem('token');localStorage.removeItem('user');delete axios.defaults.headers.common['Authorization'];dispatch({type:'LOGOUT'});};const clearError=()=>{dispatch({type:'CLEAR_ERROR'});};const value=_objectSpread(_objectSpread({},state),{},{login,logout,clearError});return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};export const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth must be used within an AuthProvider');}return context;};","map":{"version":3,"names":["React","createContext","useContext","useReducer","useEffect","axios","jsx","_jsx","defaults","baseURL","process","env","REACT_APP_API_URL","withCredentials","AuthContext","authReducer","state","action","type","_objectSpread","loading","error","isLoggedIn","user","payload","token","initialState","AuthProvider","_ref","children","dispatch","localStorage","getItem","userData","JSON","parse","headers","common","concat","removeItem","login","username","accountNumber","password","response","post","data","setItem","stringify","success","errorMessage","message","logout","clearError","value","Provider","useAuth","context","Error"],"sources":["C:/Users/pc/Desktop/INSY7314/INSY7314/frontend/src/contexts/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useReducer, useEffect } from 'react';\nimport axios from 'axios';\n\n// Set up axios defaults\naxios.defaults.baseURL = process.env.REACT_APP_API_URL || 'http://localhost:3001/api';\naxios.defaults.withCredentials = true;\n\nconst AuthContext = createContext();\n\n// Auth reducer\nconst authReducer = (state, action) => {\n  switch (action.type) {\n    case 'LOGIN_START':\n      return { ...state, loading: true, error: null };\n    case 'LOGIN_SUCCESS':\n      return {\n        ...state,\n        isLoggedIn: true,\n        user: action.payload.user,\n        token: action.payload.token,\n        loading: false,\n        error: null\n      };\n    case 'LOGIN_FAILURE':\n      return {\n        ...state,\n        isLoggedIn: false,\n        user: null,\n        token: null,\n        loading: false,\n        error: action.payload\n      };\n    case 'LOGOUT':\n      return {\n        isLoggedIn: false,\n        user: null,\n        token: null,\n        loading: false,\n        error: null\n      };\n    case 'CLEAR_ERROR':\n      return { ...state, error: null };\n    default:\n      return state;\n  }\n};\n\nconst initialState = {\n  isLoggedIn: false,\n  user: null,\n  token: null,\n  loading: false,\n  error: null\n};\n\nexport const AuthProvider = ({ children }) => {\n  const [state, dispatch] = useReducer(authReducer, initialState);\n\n  // Check for existing token on app start\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n    const user = localStorage.getItem('user');\n\n    if (token && user) {\n      try {\n        const userData = JSON.parse(user);\n        dispatch({\n          type: 'LOGIN_SUCCESS',\n          payload: { token, user: userData }\n        });\n        // Set axios default header\n        axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n      } catch (error) {\n        // Invalid stored data, clear it\n        localStorage.removeItem('token');\n        localStorage.removeItem('user');\n      }\n    }\n  }, []);\n\n  const login = async (username, accountNumber, password) => {\n    dispatch({ type: 'LOGIN_START' });\n\n    try {\n      const response = await axios.post('/auth/login', {\n        username,\n        accountNumber,\n        password\n      });\n\n      const { token, user } = response.data;\n\n      // Store in localStorage\n      localStorage.setItem('token', token);\n      localStorage.setItem('user', JSON.stringify(user));\n\n      // Set axios default header\n      axios.defaults.headers.common['Authorization'] = `Bearer ${token}`;\n\n      dispatch({\n        type: 'LOGIN_SUCCESS',\n        payload: { token, user }\n      });\n\n      return { success: true };\n    } catch (error) {\n      let errorMessage = 'Login failed';\n\n      if (error.response && error.response.data && error.response.data.error) {\n        errorMessage = error.response.data.error;\n      } else if (error.message) {\n        errorMessage = error.message;\n      }\n\n      dispatch({\n        type: 'LOGIN_FAILURE',\n        payload: errorMessage\n      });\n\n      return { success: false, error: errorMessage };\n    }\n  };\n\n  const logout = () => {\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n    delete axios.defaults.headers.common['Authorization'];\n    dispatch({ type: 'LOGOUT' });\n  };\n\n  const clearError = () => {\n    dispatch({ type: 'CLEAR_ERROR' });\n  };\n\n  const value = {\n    ...state,\n    login,\n    logout,\n    clearError\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}